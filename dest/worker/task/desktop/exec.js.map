{"version":3,"sources":["../src/worker/task/desktop/exec.ts"],"names":[],"mappings":";AAAA;;;GAGG;;;;;;;;;;AAEH,+BAA8B;AAC9B,2BAA0B;AAC1B,6BAA4B;AAE5B,mCAA+B;AAC/B,kCAA8B;AAE9B,iBAAyB,SAAQ,WAAI;IACnC;;;;OAIG;IACH,IAAW,IAAI;QACb,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,gCAAgC,EAAE,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,aAAa,CAAC,CAAA;IACjH,CAAC;IAED;;;;;OAKG;IACU,GAAG;;YACd,MAAM,GAAG,GAAG,MAAM,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA;YAChD,MAAM,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;YAE3B,IAAI,IAAI,CAAC,eAAe,CAAC,IAAI,IAAI,EAAE;gBACjC,MAAM,IAAI,SAAG,CAAC,SAAG,CAAC,KAAK,CAAC,KAAK,EAAE,0BAA0B,CAAC,CAAA;aAC3D;YAED,MAAM,SAAS,GAAG,CAAC,OAAO,IAAI,CAAC,eAAe,CAAC,CAAC,IAAI,KAAK,QAAQ,CAAC;gBAChE,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,IAAI;gBAC5B,CAAC,CAAC,EAAE,CAAA;YAEN,IAAI,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,KAAK,KAAK,EAAE;gBAClE,MAAM,IAAI,SAAG,CAAC,SAAG,CAAC,KAAK,CAAC,KAAK,EAAE,4CAA4C,CAAC,CAAA;aAC7E;QACH,CAAC;KAAA;CACF;AAhCD,kCAgCC","file":"exec.js","sourcesContent":["/**\n * houston/src/worker/task/appstream/exec.ts\n * Checks that a exec field starts with app name in the desktop file\n */\n\nimport * as fs from 'fs-extra'\nimport * as ini from 'ini'\nimport * as path from 'path'\n\nimport { Log } from '../../log'\nimport { Task } from '../task'\n\nexport class DesktopExec extends Task {\n  /**\n   * Path the desktop file should exist at\n   *\n   * @return {string}\n   */\n  public get path () {\n    return path.resolve(this.worker.workspace, 'package/usr/share/applications', this.worker.context.nameAppstream)\n  }\n\n  /**\n   * Checks Exec field in desktop file\n   *\n   * @async\n   * @return {void}\n   */\n  public async run () {\n    const raw = await fs.readFile(this.path, 'utf8')\n    const data = ini.parse(raw)\n\n    if (data['Desktop Entry'] == null) {\n      throw new Log(Log.Level.ERROR, 'Missing application data')\n    }\n\n    const execValue = (typeof data['Desktop Entry'].Exec === 'string')\n      ? data['Desktop Entry'].Exec\n      : ''\n\n    if (execValue.startsWith(this.worker.context.nameDomain) === false) {\n      throw new Log(Log.Level.ERROR, 'Exec field does not start with binary name')\n    }\n  }\n}\n"]}