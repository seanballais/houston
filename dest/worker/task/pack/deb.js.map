{"version":3,"sources":["../src/worker/task/pack/deb.ts"],"names":[],"mappings":";AAAA;;;GAGG;;;;;;;;;;AAIH,6BAA4B;AAE5B,yCAAqC;AACrC,mCAA+B;AAC/B,kCAA8B;AAE9B,aAAqB,SAAQ,WAAI;IAC/B;;;;OAIG;IACH,IAAc,IAAI;QAChB,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,SAAS,CAAC,CAAA;IACvD,CAAC;IAED;;;;;OAKG;IACU,GAAG;;YACd,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAA;YAEvD,mDAAmD;YACnD,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAA;YAE/D,IAAI,IAAI,KAAK,CAAC,EAAE;gBACd,MAAM,IAAI,SAAG,CAAC,SAAG,CAAC,KAAK,CAAC,KAAK,EAAE,+BAA+B,CAAC,CAAA;aAChE;QACH,CAAC;KAAA;IAED;;;;;;OAMG;IACa,MAAM,CAAE,CAAS;;YAC/B,MAAM,MAAM,GAAG,IAAI,eAAM,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,UAAU,CAAC,CAAA;YAEzD,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,MAAM,EAAE,CAAA;YACpC,IAAI,MAAM,KAAK,KAAK,EAAE;gBACpB,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,KAAK,CAAC,CAAA;gBAC7C,MAAM,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA;aAC5B;YAED,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,cAAc,CAAC,CAAA;YAEnD,OAAO,MAAM,CAAA;QACf,CAAC;KAAA;CACF;AA/CD,0BA+CC","file":"deb.js","sourcesContent":["/**\n * houston/src/worker/task/pack/deb.ts\n * Packages up an extracted deb file\n */\n\nimport * as fs from 'fs-extra'\nimport * as os from 'os'\nimport * as path from 'path'\n\nimport { Docker } from '../../docker'\nimport { Log } from '../../log'\nimport { Task } from '../task'\n\nexport class PackDeb extends Task {\n  /**\n   * The directory we will pack to a deb file\n   *\n   * @return {string}\n   */\n  protected get path () {\n    return path.resolve(this.worker.workspace, 'package')\n  }\n\n  /**\n   * Runs liftoff\n   *\n   * @async\n   * @return {void}\n   */\n  public async run () {\n    const docker = await this.docker(this.worker.workspace)\n\n    // The extract script will need to chmod root files\n    const exit = await docker.run('pack-deb', { Privileged: true })\n\n    if (exit !== 0) {\n      throw new Log(Log.Level.ERROR, 'Unable to pack Debian package')\n    }\n  }\n\n  /**\n   * Returns a docker instance to use for liftoff\n   *\n   * @async\n   * @param {string} p - Folder to mount for building\n   * @return {Docker}\n   */\n  protected async docker (p: string): Promise<Docker> {\n    const docker = new Docker(this.worker.config, 'pack-deb')\n\n    const exists = await docker.exists()\n    if (exists === false) {\n      const folder = path.resolve(__dirname, 'deb')\n      await docker.create(folder)\n    }\n\n    docker.mount(this.worker.workspace, '/tmp/houston')\n\n    return docker\n  }\n}\n"]}